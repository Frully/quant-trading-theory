# 第十七章：风险理论

> **核心问题**：什么是风险？如何度量风险？为什么传统风险模型在危机时失效？

---

## 核心概念定义

### 什么是风险？

![尾部风险：正态分布 vs. 肥尾分布](../assets/charts/tail_risk.png)

**风险 (Risk)** 是对未来不确定性可能带来的损失的度量。

**不同视角下的风险定义**：

| 视角 | 定义 | 度量方式 |
|-----|------|---------|
| 统计视角 | 收益的波动性 | 标准差、方差 |
| 投资者视角 | 亏损的可能性 | 下行风险、VaR |
| 监管视角 | 系统崩溃的风险 | 压力测试、资本要求 |
| 行为视角 | 让人感到恐惧的东西 | 主观感受 |

**Frank Knight的区分**：

| 概念 | 定义 | 特点 |
|-----|------|-----|
| **风险 (Risk)** | 可以量化概率的不确定性 | 可以用统计方法处理 |
| **不确定性 (Uncertainty)** | 无法量化概率的未知 | 无法用传统模型处理 |

**例子**：
- 风险：抛硬币，50%正面50%反面——概率已知
- 不确定性：明年会发生什么新型金融危机？——无法预知

### 为什么风险度量困难？

**核心挑战**：

1. **风险是关于未来的**：我们只能用过去的数据来估计
2. **极端事件稀少**：最重要的事件样本最少
3. **系统会变化**：历史可能不代表未来
4. **度量影响行为**：风险度量本身会改变风险（Goodhart's Law）

**例子**：
- 2006年基于历史数据计算的房价下跌风险很低
- 因为过去几十年全国房价从未同时下跌
- 但这不代表未来不会发生
- 2008年，全国房价同时下跌，模型崩溃

---

## 一、传统风险度量

### 1.1 波动率（标准差）

**定义**：收益率的标准差，衡量收益围绕均值的离散程度。

$$\sigma = \sqrt{\frac{1}{T-1} \sum_{t=1}^{T} (r_t - \bar{r})^2}$$

**优点**：
- 简单直观
- 数学性质好（可加性）
- 广泛使用

**缺点**：
- 把上涨也当作"风险"
- 假设正态分布
- 对极端事件不敏感

**例子**：

| 股票 | 年化波动率 | 最大回撤 | 风险评估 |
|-----|----------|---------|---------|
| A | 20% | -25% | 中等风险 |
| B | 20% | -60% | 看起来相同，但实际风险更高 |

波动率相同，但股票B经历过更严重的极端下跌——波动率没有捕捉到这种尾部风险。

### 1.2 Beta

**定义**：资产收益对市场收益的敏感度。

$$\beta = \frac{Cov(r_i, r_m)}{Var(r_m)}$$

**解释**：
- β = 1：与市场同步波动
- β > 1：比市场波动更大
- β < 1：比市场波动更小
- β < 0：与市场反向波动

**局限性**：
- 只衡量系统性风险
- 假设线性关系
- Beta会随时间变化
- 危机时Beta往往上升

**例子**：
- 正常时期：某对冲基金β = 0.3，看起来低风险
- 2008年危机：该基金β飙升到1.5
- "低Beta"策略在最需要保护时失效

### 1.3 下行风险指标

**问题**：投资者更关心亏损，而不是整体波动。

**半方差 (Semivariance)**：只计算低于目标收益的波动。

$$SV = \frac{1}{T} \sum_{t: r_t < \bar{r}} (r_t - \bar{r})^2$$

**Sortino比率**：用下行波动率替代标准差。

$$Sortino = \frac{r_p - r_f}{\sigma_{downside}}$$

**最大回撤 (Maximum Drawdown)**：从峰值到谷底的最大跌幅。

$$MDD = \max_{t} \left( \max_{s \leq t} P_s - P_t \right) / \max_{s \leq t} P_s$$

**例子**：

| 指标 | 策略A | 策略B |
|-----|-------|-------|
| 年化收益 | 15% | 15% |
| 波动率 | 20% | 20% |
| 夏普比率 | 0.60 | 0.60 |
| 最大回撤 | -25% | -50% |
| Sortino | 0.85 | 0.50 |

夏普比率相同，但Sortino和最大回撤显示策略B的下行风险更大。

---

## 二、VaR与CVaR

### 2.1 VaR的定义

**风险价值 (Value at Risk, VaR)** 是在给定置信水平下，在特定时间段内的最大预期损失。

**数学定义**：

$$P(Loss > VaR) = 1 - \alpha$$

其中α是置信水平（如95%或99%）。

**通俗解释**：
- 95% VaR = 100万元
- 意味着：有95%的把握，损失不会超过100万元
- 或者说：有5%的概率，损失会超过100万元

**例子**：
- 投资组合价值1亿元
- 日95% VaR = 200万元
- 解释：在正常市场条件下，有95%的把握一天内损失不超过200万元

### 2.2 VaR的计算方法

**方法1：历史模拟法**

```
步骤：
1. 收集历史收益率数据（如过去500天）
2. 按从小到大排序
3. 找到第5%分位数（如第25个最差收益）
4. 这就是95% VaR
```

**优点**：不需要分布假设
**缺点**：依赖历史数据，极端事件样本少

**方法2：参数法（正态分布假设）**

$$VaR_{\alpha} = \mu - z_{\alpha} \cdot \sigma$$

其中 $z_{\alpha}$ 是标准正态分布的分位数（95%时约为1.65）。

**例子**：
- 日均收益μ = 0.05%
- 日波动率σ = 2%
- 95% VaR = 0.05% - 1.65 × 2% = -3.25%
- 对于1亿组合，VaR = 325万元

**优点**：计算简单
**缺点**：正态分布假设不符合现实

**方法3：蒙特卡洛模拟**

```
步骤：
1. 建立收益率的统计模型
2. 生成大量模拟路径（如10000条）
3. 计算每条路径的损益
4. 找到5%分位数
```

**优点**：灵活，可处理复杂组合
**缺点**：计算量大，依赖模型假设

### 2.3 VaR的局限性

**问题1：不满足次可加性**

$$VaR(A+B) \not\leq VaR(A) + VaR(B)$$

这意味着分散化可能反而增加VaR——违反直觉且不合理。

**问题2：不告诉你尾部有多糟**

VaR只告诉你"5%的情况下会超过这个损失"，但不告诉你超过后会损失多少。

**例子**：

| 组合 | 95% VaR | 超过VaR后的平均损失 |
|-----|---------|-------------------|
| A | 100万 | 120万 |
| B | 100万 | 500万 |

两者VaR相同，但组合B在极端情况下损失大得多。

**问题3：给出虚假的精确感**

"99% VaR = 325.7万元"——这种精确数字给人信心，但建立在大量假设之上。

### 2.4 CVaR/Expected Shortfall

**条件风险价值 (CVaR)** 或**预期短缺 (Expected Shortfall, ES)**：超过VaR时的平均损失。

$$CVaR_{\alpha} = E[Loss | Loss > VaR_{\alpha}]$$

**优点**：
- 满足次可加性（是"一致性风险度量"）
- 考虑了尾部的严重程度
- 更适合风险管理

**例子**：
- 95% VaR = 100万元
- 95% CVaR = 150万元
- 意思：当损失超过VaR时，平均损失150万元

**正态分布下的关系**：

$$CVaR_{95\%} \approx 1.27 \times VaR_{95\%}$$

但在肥尾分布下，CVaR可能是VaR的好几倍。

### 2.5 监管框架中的应用

**Basel协议的演变**：

| 版本 | 风险度量 | 置信度 | 时间窗口 |
|-----|---------|-------|---------|
| Basel I (1988) | 简单比率 | - | - |
| Basel II (2004) | VaR | 99% | 10天 |
| Basel III (2010) | VaR + 压力VaR | 99% | 10天 |
| Basel IV (2017) | CVaR (ES) | 97.5% | 调整后 |

**为什么从VaR转向CVaR？**

2008年金融危机表明VaR低估了尾部风险。CVaR更保守，更适合监管目的。

---

## 三、肥尾与极端风险

### 3.1 正态分布的失效

**正态分布的预测vs现实**：

| 事件 | 正态分布预测频率 | 实际频率 |
|-----|----------------|---------|
| 3σ事件（日波动2%下约6%单日波动）| 每年1次 | 每年数次 |
| 4σ事件 | 每63年1次 | 每几年1次 |
| 5σ事件 | 每7000年1次 | 每10-20年1次 |
| 6σ事件 | 每400万年1次 | 历史上发生过多次 |

**例子：1987年黑色星期一**
- 道琼斯一天下跌22.6%
- 假设年化波动率20%，日波动率约1.26%
- 这是一个约18σ事件
- 正态分布下的概率：约10^(-74)
- 比宇宙中原子数量的倒数还小
- 但它确实发生了

### 3.2 肥尾分布的特征

**肥尾 (Fat Tails)**：极端事件发生的概率比正态分布预测的更高。

**图示**：

```
概率密度
    ^
    |     正态分布
    |    /    \
    |   /      \
    |  /   肥尾分布
    | / \_    _/ \
    |/    \__/    \___
    +-----------------------> 收益率
       -4σ  -2σ  0  +2σ  +4σ
```

**常见的肥尾分布**：

| 分布 | 特点 | 应用 |
|-----|------|-----|
| Student-t | 尾部更厚，由自由度控制 | 收益率建模 |
| 稳定分布 | 可以有无限方差 | 极端波动建模 |
| 混合正态 | 两个正态的混合 | 状态转换建模 |

**Student-t分布**：

当自由度ν较小时，尾部更厚：
- ν = ∞：正态分布
- ν = 4：比正态尾部厚得多
- ν ≤ 2：方差无限大

**实证发现**：股票收益的分布大约相当于ν = 4-5的t分布。

### 3.3 极值理论 (EVT)

**核心思想**：专门研究分布的尾部行为，而不是整体分布。

**极值定理 (Fisher-Tippett-Gnedenko)**：

无论原始分布是什么，极端值的分布收敛于三种类型之一：
- Gumbel（指数型尾部）
- Fréchet（多项式型尾部，肥尾）
- Weibull（有界尾部）

金融收益通常属于Fréchet类型（肥尾）。

**超阈值模型 (POT, Peaks Over Threshold)**：

超过某阈值u的损失服从广义帕累托分布(GPD)：

$$P(X > x | X > u) = \left(1 + \xi \frac{x-u}{\beta}\right)^{-1/\xi}$$

其中ξ是形状参数，控制尾部厚度。

**应用**：
- 设定阈值（如95%分位数以上的损失）
- 用GPD拟合超阈值的损失
- 外推计算极端分位数（如99.9%）

### 3.4 黑天鹅与灰犀牛

**黑天鹅 (Black Swan)**（Nassim Taleb）：

| 特征 | 说明 |
|-----|------|
| 稀有 | 超出正常预期范围 |
| 冲击大 | 影响巨大 |
| 事后可解释 | 发生后人们觉得"早该想到" |

**例子**：
- 2001年9/11恐怖袭击
- 2008年金融危机
- 2020年新冠疫情

**灰犀牛 (Grey Rhino)**（Michele Wucker）：

| 特征 | 说明 |
|-----|------|
| 可预见 | 大家都知道风险存在 |
| 高概率 | 很可能发生 |
| 被忽视 | 因为各种原因不采取行动 |

**例子**：
- 房地产泡沫（2008年前很多人预警过）
- 人口老龄化
- 债务危机

**风险管理的启示**：
- 对黑天鹅：不要假设它不会发生，保持鲁棒性
- 对灰犀牛：不要忽视明显的风险，即使它还没发生

---

## 四、相关性动态

### 4.1 危机时相关性上升

**正常时期vs危机时期**：

| 时期 | 股票间相关性 | 股票-债券相关性 |
|-----|------------|----------------|
| 正常 | 0.3-0.5 | -0.2-0.2 |
| 危机 | 0.7-0.9 | 不稳定，可能翻正 |

**例子：2008年金融危机**

```
          正常时期    危机时期
股票-债券    -0.1       +0.3
美股-欧股     0.6        0.9
股票-商品     0.2        0.7
```

**后果**：在最需要分散化的时候，分散化失效了。

### 4.2 为什么相关性会变化？

**1. 共同因素驱动**

危机时，所有资产都受同一因素影响（如流动性恐慌）。

**2. 传染效应**

一个市场的问题传导到其他市场。

**3. 投资者行为**

恐慌性抛售不区分资产质量。

**4. 杠杆与强平**

被迫卖出导致所有资产下跌。

### 4.3 Copula方法

**问题**：传统相关系数只能捕捉线性关系，无法描述尾部相关性。

**Copula的思想**：将边际分布和相关结构分离。

$$F(x,y) = C(F_X(x), F_Y(y))$$

其中C是Copula函数，连接两个边际分布。

**常见Copula**：

| Copula | 特点 | 适用场景 |
|--------|------|---------|
| 高斯Copula | 无尾部相关 | 正常市场 |
| t-Copula | 对称尾部相关 | 危机建模 |
| Clayton | 下尾相关强 | 下跌时联动 |
| Gumbel | 上尾相关强 | 上涨时联动 |

**2008年金融危机与Copula**：

CDO定价广泛使用高斯Copula，假设违约相关性不高。危机时违约高度相关，模型严重低估了风险。

### 4.4 系统性风险与传染

**系统性风险 (Systemic Risk)**：整个金融系统崩溃的风险，无法通过分散化消除。

**传染机制**：

| 渠道 | 机制 | 例子 |
|-----|------|-----|
| 直接敞口 | A欠B钱，A倒闭B也受损 | 雷曼倒闭影响债权人 |
| 资产抛售 | A被迫卖出，价格下跌，B资产减值 | 2008年火售 |
| 信息传染 | A出问题，市场怀疑B也有问题 | 银行挤兑 |
| 流动性传染 | A的资金提供者撤资，转向B | 货币市场冻结 |

**度量指标**：

| 指标 | 含义 |
|-----|------|
| CoVaR | 一家机构出问题时，系统的VaR |
| MES | 市场大跌时，单个机构的预期损失 |
| SRISK | 系统性风险发生时的资本缺口 |

---

## 五、风险模型的失败

### 5.1 2008年金融危机的教训

**模型失败的表现**：

| 失败点 | 问题 |
|-------|------|
| VaR低估风险 | 基于正常时期数据，未捕捉尾部风险 |
| 相关性假设错误 | 假设资产相关性稳定，危机时飙升 |
| CDO定价失败 | 高斯Copula低估违约相关性 |
| 评级失效 | AAA评级产品大量违约 |
| 压力测试不足 | 未考虑足够极端的情景 |

**例子：CDO风险评估**

```
模型假设：
- 底层房贷违约相关性 = 20%
- 基于这个假设，高级档（Senior Tranche）风险很低

实际情况：
- 房价全国同时下跌
- 违约相关性飙升到70-80%
- 高级档大量违约
```

### 5.2 模型风险

**模型风险 (Model Risk)**：使用错误或不当模型导致的风险。

**来源**：

| 来源 | 例子 |
|-----|------|
| 错误假设 | 假设正态分布、假设相关性稳定 |
| 数据问题 | 数据质量差、样本期太短 |
| 实现错误 | 编程bug、计算错误 |
| 误用 | 在不适用的场景使用模型 |
| 过度依赖 | 把模型当作真理 |

**著名案例**：

**LTCM（1998年）**：
- 模型基于历史相关性
- 假设收敛交易会在合理时间内收敛
- 俄罗斯违约导致所有资产相关性飙升
- 杠杆过高，无法等待收敛
- 损失46亿美元，差点引发系统性危机

**教训**：
> "市场保持非理性的时间可以比你保持偿付能力的时间更长" —— 凯恩斯

### 5.3 压力测试

**定义**：评估组合在极端但可能发生的情景下的表现。

**类型**：

| 类型 | 方法 | 目的 |
|-----|------|-----|
| 历史情景 | 重现1987、2008等危机 | 检验已知风险 |
| 假设情景 | 构造合理的极端情景 | 检验潜在风险 |
| 敏感性分析 | 改变单一因素 | 理解风险敞口 |
| 反向压力测试 | 找出什么情景会导致破产 | 识别关键风险 |

**设计原则**：

1. **足够严重**：不是小波动，是真正的危机
2. **足够合理**：不是完全不可能的情景
3. **足够全面**：覆盖多种风险因素
4. **有行动价值**：结果能指导风险管理

**例子：简单压力测试**

| 情景 | 股票 | 债券 | 商品 | 组合损失 |
|-----|------|------|-----|---------|
| 2008重现 | -50% | +10% | -40% | -35% |
| 利率飙升 | -20% | -20% | 0% | -18% |
| 滞胀 | -30% | -15% | +20% | -20% |
| 全面恐慌 | -40% | -5% | -30% | -30% |

---

## 六、风险度量的选择

### 6.1 不同目的的度量选择

| 目的 | 推荐度量 | 原因 |
|-----|---------|-----|
| 日常监控 | 波动率 | 简单、及时 |
| 资本计算 | VaR/CVaR | 监管标准 |
| 组合优化 | 协方差矩阵 | 数学性质好 |
| 尾部风险 | CVaR、压力测试 | 关注极端情况 |
| 业绩评估 | 最大回撤、Sortino | 关注下行风险 |

### 6.2 多指标综合

**单一指标的问题**：没有一个指标能完整描述风险。

**综合框架**：

```
日常监控
├── 波动率（整体波动）
├── VaR（正常情况下的尾部）
└── Beta（市场敏感度）

深度分析
├── CVaR（极端情况）
├── 压力测试（特定情景）
├── 流动性风险（退出成本）
└── 集中度（大敞口）

定期回顾
├── 最大回撤（历史最差）
├── 回撤时间（恢复速度）
└── 模型验证（预测vs实际）
```

### 6.3 风险度量的时间维度

| 时间范围 | 关注点 | 方法 |
|---------|-------|-----|
| 日内 | 执行风险、日内波动 | 高频VaR |
| 日级 | 隔夜风险、日波动 | 日VaR |
| 周/月 | 组合风险、再平衡 | 滚动波动率 |
| 年级 | 战略配置、长期风险 | 长期压力测试 |

---

## 七、对量化交易的启示

### 7.1 风险预算框架

**从"我能承受多少风险？"开始**

```
总风险预算：年化波动率10%

分配：
├── 策略A（动量）：3%风险贡献
├── 策略B（价值）：3%风险贡献
├── 策略C（套利）：2%风险贡献
└── 现金缓冲：2%
```

**风险预算vs资金配置**：

| 策略 | 波动率 | 资金配置 | 风险贡献 |
|-----|-------|---------|---------|
| A | 15% | 20% | 3% |
| B | 10% | 30% | 3% |
| C | 5% | 40% | 2% |
| 现金 | 0% | 10% | 0% |

### 7.2 尾部风险管理

**原则**：活着比赚钱重要。

**方法**：

| 方法 | 成本 | 保护程度 |
|-----|------|---------|
| 持有现金 | 机会成本 | 中等 |
| 分散化 | 低 | 正常时有效 |
| 止损 | 交易成本 | 取决于执行 |
| 买入看跌期权 | 期权费 | 高 |
| 尾部风险基金 | 费用 | 专业化 |

**买入保护的考量**：

```
策略价值：1亿元
最大可承受损失：2000万（20%）
保护成本：每年150万（1.5%）

问题：
- 如果市场正常，每年损失1.5%的保护费
- 如果发生尾部事件，保护带来的价值可能远超成本
- 如何平衡？

答案：取决于
- 尾部事件的概率估计
- 风险承受能力
- 对保护成本的承受能力
```

### 7.3 风险管理的层次

**三道防线**：

| 层次 | 职责 | 工具 |
|-----|------|-----|
| 第一道 | 交易/投资团队 | 日常风控、止损 |
| 第二道 | 风险管理部门 | 独立监控、限额管理 |
| 第三道 | 高管/董事会 | 策略审批、资本配置 |

### 7.4 实践建议

| 建议 | 原因 |
|-----|------|
| 不要只看一个指标 | 单一指标无法完整描述风险 |
| 关注尾部而非均值 | 极端事件最致命 |
| 假设相关性会上升 | 危机时分散化会失效 |
| 保持流动性 | 在需要调整时有能力调整 |
| 怀疑你的模型 | 所有模型都是错的 |
| 做压力测试 | 想象最坏情况 |
| 留有余地 | 不要用满杠杆 |

### 7.5 常见错误

| 错误 | 后果 |
|-----|------|
| 只看波动率 | 忽视尾部风险 |
| 相信VaR的精确性 | 低估极端损失 |
| 假设历史会重复 | 未考虑新型风险 |
| 忽视流动性风险 | 无法在需要时退出 |
| 过度依赖模型 | 模型失效时措手不及 |
| 不做压力测试 | 对极端情况没有准备 |

---

## 八、总结

### 核心要点

1. **风险不等于波动率**：波动率是最常用的度量，但忽视了下行风险和尾部风险

2. **VaR有严重局限**：不告诉你尾部有多糟，在危机时低估风险

3. **肥尾是现实**：极端事件比正态分布预测的频繁得多

4. **相关性会变化**：在最需要分散化的时候，相关性往往飙升

5. **模型会失败**：所有模型都是对现实的简化，会在某些情况下失效

6. **活着最重要**：控制尾部风险比追求收益更重要

### 关键概念

| 概念 | 要点 |
|-----|------|
| VaR | 给定置信度下的最大损失，但不告诉尾部有多糟 |
| CVaR | 超过VaR时的平均损失，更好的尾部度量 |
| 肥尾 | 极端事件概率高于正态分布预测 |
| 相关性动态 | 危机时相关性上升，分散化失效 |
| 模型风险 | 模型错误或误用带来的风险 |

### 风险管理检查清单

- [ ] 使用多个风险指标，不只是波动率
- [ ] 定期进行压力测试
- [ ] 考虑相关性在危机时的变化
- [ ] 保持足够的流动性缓冲
- [ ] 设定明确的风险限额
- [ ] 有尾部风险的应对预案
- [ ] 定期验证风险模型

---

## 加密货币市场的特殊考量

加密货币市场的风险特征与传统市场有显著差异。

### 极端波动率

| 资产 | 日波动 1% | 日波动 5% | 日波动 10%+ |
|------|----------|----------|------------|
| 标普500 | 常见 | 罕见 | 极罕见 |
| 比特币 | 常见 | 常见 | 偶尔 |
| 山寨币 | 常见 | 常见 | 常见 |

**VaR 失效更严重**：加密市场的肥尾比传统市场更肥，正态分布假设偏离更大。

### 独有风险类型

| 风险类型 | 说明 | 缓解措施 |
|---------|------|---------|
| 交易所风险 | 被黑、跑路、冻结 | 分散存放，冷钱包 |
| 智能合约风险 | 代码漏洞 | 只用审计过的协议 |
| 监管风险 | 政策突变 | 分散跨司法管辖区 |
| 网络风险 | 拥堵、分叉 | 预留 Gas，监控网络 |

### 相关性更不稳定

- **正常时期**：加密资产与传统资产相关性较低
- **危机时期**：可能突然与风险资产高度相关
- **加密内部**：危机时所有币种相关性趋近于 1

**2022 年 FTX 事件**：
- 几乎所有加密资产同时暴跌
- 分散化完全失效
- "不相关"的 DeFi 协议也受冲击

### 风险管理调整

1. **更保守的仓位**：杠杆不超过 2x
2. **更宽的止损**：适应更高的日常波动
3. **交易所分散**：不超过 30% 资金在单一交易所
4. **冷钱包比例**：长期持有部分转冷钱包

> **启示**：加密市场是传统风险模型的极端压力测试。VaR 等工具严重低估真实风险，需要更保守的风险预算。
>
> 详见 [第十二章：加密货币市场](12_cryptocurrency_markets.md)

---

## 参考文献

1. **Taleb, N. N.** (2007). *The Black Swan: The Impact of the Highly Improbable*
2. **Jorion, P.** (2007). *Value at Risk: The New Benchmark for Managing Financial Risk*
3. **McNeil, A. J., Frey, R., & Embrechts, P.** (2015). *Quantitative Risk Management*
4. **Mandelbrot, B., & Hudson, R. L.** (2004). *The Misbehavior of Markets*
5. **Lo, A. W.** (2017). *Adaptive Markets: Financial Evolution at the Speed of Thought*
6. **Rebonato, R.** (2007). *Plight of the Fortune Tellers: Why We Need to Manage Financial Risk Differently*

---

# 加密货币金字塔趋势跟踪策略 (Crypto Pyramid Trend Following)

> **文档版本**：v3.0 (完整深度版)
> **策略类型**：系统化趋势跟踪 + 动态仓位管理
> **目标市场**：高波动性加密货币永续合约
> **风险偏好**：进攻型增长 (Aggressive Growth)

---

## 目录

1. [策略核心哲学](#一策略核心哲学)
2. [理论基础与学术支撑](#二理论基础与学术支撑)
3. [市场环境过滤系统](#三市场环境过滤系统)
4. [多头主力系统 (Long Engine)](#四多头主力系统-the-long-engine)
5. [空头辅助系统 (Short Module)](#五空头辅助系统-the-short-module)
6. [资金管理与组合构建](#六资金管理与组合构建)
7. [风险控制与极端情况处理](#七风险控制与极端情况处理)
8. [深度设计问答 (FAQ)](#八深度设计问答-faq)
9. [回测验证清单](#九回测验证清单)
10. [总结与核心公式速查](#十总结与核心公式速查)

---

## 一、策略核心哲学

本策略不是简单的指标堆砌，而是基于对加密货币市场**微观结构**和**统计特性**的深刻理解。所有规则都服务于三个核心公理。

### 1.1 肥尾效应与非对称性 (Fat Tails & Asymmetry)

加密货币的回报分布具有极端的"肥尾"特征，这与正态分布假设的传统金融资产截然不同。

- **核心事实**：比特币历史上 **90% 的累计涨幅仅由不到 5% 的交易日贡献**。这意味着绝大多数时间市场都在"磨洋工"，真正的财富效应只在极少数爆发性行情中产生。
- **策略推论**：
    1. 我们必须**永远在线**（趋势跟踪），因为错过那 5% 的日子，就错过了 90% 的利润。
    2. 我们必须在暴涨发生时**重仓持有**（金字塔加仓），初始的小仓位不足以改变命运，必须在盈利时果断加注。

### 1.2 生存优先于收益 (Survival > Profit)

在高波动市场中，一次失控的亏损足以让账户归零。因此，**首要目标是活着，其次才是盈利**。

- **核心事实**：加密货币经常发生单日 30%-50% 的剧烈波动。标志性事件如：
    - **2020.3.12 ("312")**：BTC 单日暴跌 50%。
    - **2021.5.19 ("519")**：BTC 从历史高点 6 万美元暴跌至 3 万美元。
- **策略推论**：
    1. 任何让账户暴露在"无限风险"中的行为（如重仓做空、逆势扛单、不设止损）都是**绝对禁止**的。
    2. 这就引出了本策略独特的**"非对称风控"**：对做多宽容（可加仓），对做空严苛（禁加仓、半仓位）。

### 1.3 价格包含一切 (Price Action First)

加密货币缺乏可靠的基本面锚点（如市盈率、现金流、分红）。因此，**价格行为本身就是最强的信息源**。

- **核心事实**：无法通过 DCF 模型或相对估值法定价比特币。它的价值完全由市场共识和资金流动决定。
- **策略推论**：
    1. 策略**不预测"底"和"顶"**，只跟随价格突破。
    2. 突破即入场，跌破即离场，不做主观判断。

---

## 二、理论基础与学术支撑

本策略的每一个规则都有经典理论或学术研究的支撑。这不是"拍脑袋"的设计，而是经得起推敲的系统。

### 2.1 金字塔加仓的理论起源

金字塔加仓（Pyramiding）是一种**反马丁格尔 (Anti-Martingale)** 策略，与臭名昭著的"亏损加倍"（Martingale）恰好相反。

| 特性 | 马丁格尔 (Martingale) | 反马丁格尔 (Anti-Martingale) |
|------|----------------------|----------------------------|
| **触发条件** | 亏损时加仓 | **盈利时加仓** |
| **风险特征** | 亏损时风险敞口急剧放大 | **盈利时风险敞口放大，亏损时收缩** |
| **结局** | 长期必破产（赌场被禁策略） | 长期可持续，适合趋势市场 |
| **代表人物** | 无 (赌场禁用) | **Jesse Livermore, Turtle Traders** |

- **Jesse Livermore (杰西·利弗莫尔)**：华尔街传奇投机者，在《股票大作手回忆录》中强调：**"只应该在浮盈时加仓，绝不在亏损时摊平"**。他的策略核心是"用市场的钱去赌"。
- **Turtle Traders (海龟交易员)**：理查德·丹尼斯培训的一批交易员，采用系统化的趋势跟踪和金字塔加仓策略，在 1980 年代创造了惊人的收益。

### 2.2 "风险置换" (Risk Transition) 与 Van Tharp 的 "0R Trade"

著名的交易心理学导师 **Van Tharp 博士**提出了 **R-Multiple** 的概念，用于量化交易的风险与回报。

- **1R**：代表一笔交易的初始风险（入场价到止损价的距离乘以仓位）。
- **0R Trade（零风险交易）**：当止损移至保本价时，交易的风险变为 0R。此时，即使被止损，也不会亏损本金。

**Van Tharp 的核心法则**：**只有当底仓变成 "0R 状态"（即止损移至保本）时，你才拥有了使用杠杆加仓的"资格"。**

这个法则是本策略"加仓即移损至保本"规则的直接来源。

### 2.3 Livermore 的 "Market's Money" 原则

Livermore 强调：**"后续加仓必须完全由'市场的钱'（即浮盈）来买单，绝不能动用'本金'。"**

本策略的执行方式：
1. 底仓入场，承担 1R 风险（本金）。
2. 浮盈 1 ATR 后，加仓 0.5 Unit，同时止损移至保本。
3. **此刻起**，所有后续的风险暴露（加仓部分）都是在消耗**"浮盈"（市场的钱）**，本金已被锁定。

### 2.4 动量效应在加密货币市场的有效性

- **Liu et al. (2020)** 研究发现，在加密货币市场，**纯多头 (Long-Only)** 的动量策略显著跑赢 **多空 (Long-Short)** 策略。做空部分的收益在扣除费率后经常为负。
- **Grobys & Sapkota (2019)** 指出，加密货币的动量效应主要由"赢家组合"驱动，"输家组合"（做空端）表现疲软。

**结论**：学术证据支持本策略的"非对称设计"——做多积极进攻，做空保守防御。

---

## 三、市场环境过滤系统

在入场前，必须确认市场处于**"可交易状态"**。我们不仅要方向，还要质量。盲目入场只会被市场反复打脸（Whipsaw）。

### 3.1 趋势强度过滤：ADX(14) > 20

**指标定义**：ADX (Average Directional Index，平均趋向指标) 衡量的是趋势的**强弱**，而非方向。数值越高，趋势越明显。

- **ADX < 20**：市场处于无序震荡或"死鱼"状态。此时无论突破还是跌破，大概率是假信号，入场会被反复双向打脸。
- **ADX > 20**：趋势开始形成，"风"刮起来了，可以扬帆出海。
- **ADX > 40**：趋势极强，但通常意味着趋势末期，需警惕反转。

**执行规则**：**只有当 ADX(14) > 20 时，才允许入场。**

### 3.2 牛熊分界线：EMA(200)

**指标定义**：EMA (Exponential Moving Average，指数移动平均线) 的 200 日线是机构公认的长期牛熊分界线。

- **价格 > EMA(200)**：长期多头主导，市场处于牛市结构。此时**只允许做多**。
- **价格 < EMA(200)**：长期空头主导，市场处于熊市结构。此时**只允许做空**（如果选择启用空头模块）。

**禁止行为**：
- 严禁在 EMA(200) 下方做多（抢反弹 = 火中取栗）。
- 严禁在 EMA(200) 上方做空（摸顶 = 螳臂当车）。

### 3.3 波动率熔断：ATR/Price > 10%

**指标定义**：将 ATR(14) 除以当前价格，得到"标准化波动率"。当该值超过 10% 时，意味着日均波动极大（例如 BTC 价格 5 万美元时，每天震荡 5000 美元）。

**熔断规则**：
1. **暂停所有新开仓**（无论多空）。
2. **将存量仓位减半**（风险敞口收缩）。

**逻辑**：极端波动通常发生在崩盘或赶顶阶段，此时技术指标失效、滑点剧增、止损单可能无法按预期成交。**保命第一，利润第二。**

### 3.4 资金费率过滤 (Funding Rate Filter)

永续合约中，资金费率代表多空双方的持仓成本。极端的费率往往是市场情绪的顶峰信号。

| 年化费率 | 8 小时费率 | 市场含义 | 操作规则 |
|---------|-----------|---------|---------|
| > 50% | > 0.05% | 做多极度拥挤，短期见顶风险大 | **禁止开新多单，禁止加仓** |
| < -50% | < -0.05% | 做空极度拥挤，短期见底风险大 | **禁止开空单** (极易发生扎空) |

---

## 四、多头主力系统 (The Long Engine)

这是策略的**"利润收割机"**，也是核心模块。设计目标是：**在趋势确立后，尽可能安全地把仓位加上去，同时严格控制回撤。**

### 4.1 入场信号 (Entry Signal)

**触发条件**：价格突破**过去 20 日最高价 (Donchian High 20)**。

**确认机制**：必须等待**日线收盘价 (Daily Close)** 站稳突破位。

**原因**：
- 加密货币盘中经常出现 5%-10% 的"骗线"（False Breakout），随后迅速回落留下长上影线。
- 收盘价确认能过滤掉约 60% 的假突破，大幅提升入场质量。

**示例**：
- BTC 过去 20 天最高价为 $50,000。
- 今日盘中最高触及 $51,000，但收盘回落至 $49,500。**不入场**（假突破）。
- 次日收盘价为 $51,200。**确认入场**。

### 4.2 初始头寸计算 (Initial Sizing)

我们放弃"全仓梭哈"的赌博心态，采用基于波动率的**风险平价 (Volatility Parity)** 头寸计算。

**核心参数**：
- **ATR 周期**：14 根 K 线
- **ATR 时间框架**：**日线 (Daily)** 或 **4 小时线 (4H)**——见下文分析
- **单笔风险 (R)**：总账户权益的 **1%**
- **初始止损距离**：**2.5 倍 ATR**

**公式**：
$$
\text{初始持仓手数} = \frac{\text{账户总权益} \times 1\%}{2.5 \times ATR(14)}
$$

#### ATR 时间框架选择：日线 vs 4 小时线

用户提出的问题非常关键：**日线 ATR 是否导致仓位过小？** 答案取决于你的交易风格和风险承受能力。

**核心权衡**：

| 时间框架 | ATR 大小 | 仓位大小 | 止损被扫概率 | 适用场景 |
|---------|---------|---------|-------------|---------|
| **日线 (Daily)** | 大 (~3-5% 价格) | 较小 | **低** (宽止损) | 波段交易、懒人策略、低风险偏好 |
| **4 小时 (4H)** | 中 (~1.5-2.5% 价格) | 中等 | 中 | 平衡型策略、活跃波段交易 |
| **1 小时 (1H)** | 小 (~0.8-1.2% 价格) | 较大 | **高** (窄止损) | 日内交易、高频策略 |

**具体数学示例 (BTC 价格 $50,000)**：

| 时间框架 | ATR 值 | 止损距离 (2.5×ATR) | $10万账户初始仓位 |
|---------|--------|-------------------|------------------|
| **日线** | $2,000 | $5,000 | 0.2 BTC ($10,000) |
| **4H** | $1,000 | $2,500 | 0.4 BTC ($20,000) |
| **1H** | $500 | $1,250 | 0.8 BTC ($40,000) |

**针对加密货币市场的建议**：

1.  **推荐使用 4H ATR (平衡选择)**：
    - 日线 ATR 在加密货币中确实偏大（BTC 日波动 3-5% 很常见），会导致仓位较保守。
    - 4H ATR 是一个**甜蜜点**：既能过滤掉小级别噪音，又不会像日线那样过于保守。
    - 多数量化交易者在加密货币中使用 4H 或 6H 级别。

2.  **日线 ATR 适用场景**：
    - 如果你无法频繁看盘（每周只看 1-2 次）。
    - 如果你的策略是"超长波段"（持仓数周到数月）。
    - 如果你是风险厌恶型，宁可少赚也不想被频繁止损。

3.  **1H ATR 风险警告**：
    - 加密货币 1H 级别噪音极大，即使使用 2.5 ATR 止损也容易被"插针"扫掉。
    - **不建议**用于趋势跟踪策略，仅适合高频量化。

> [!TIP]
> **多时间框架方案**：使用 **4H ATR** 计算仓位大小和加仓间距，但使用 **日线收盘价** 作为入场/离场确认信号。这样既能保证仓位大小合理，又能过滤假突破。

**参数解释**：
1. **1% 风险 (R)**：这是"试错成本"。如果这笔交易被止损了，只亏总资金的 1%。连续亏损 10 次也只损失 10%，账户依然健康。
2. **2.5 ATR 止损**：
    - 为什么是 2.5？传统金融通常用 2 ATR，但币圈噪音更大，2.5 倍能提供更宽的"呼吸空间"。
    - **关键**：这个止损是**固定的 (Fixed)**，不会自动跟踪。
        - 止损位置 = `开仓价 - 2.5 × ATR(开仓时刻)`
        - ATR 值使用**开仓时刻**的静态值，不会随时间变化。
        - 止损线**固定不动**，除非被金字塔加仓规则**手动上移**（如移至保本位）。
    - **为什么不用动态 ATR？** 如果用动态 ATR，当行情快速上涨时 ATR 会变大，导致止损反而被"往下推"——明明赚钱了，止损却更远了。这是不合理的。

**具体例子**：
- 账户权益：$100,000
- BTC 当前 ATR(14)：$2,000
- 单笔风险：$100,000 × 1% = $1,000
- 止损距离：2.5 × $2,000 = $5,000
- **初始持仓**：$1,000 / $5,000 = **0.2 BTC**

### 4.3 "缩量金字塔"加仓详解 (Pyramiding Logic)

这是本策略的**灵魂**所在。我们采用 **100% -> 50% -> 50% -> 50%** 的递减加仓结构。

#### 4.3.1 为什么要"缩量"而非"等量"或"倒金字塔"？

| 加仓类型 | 结构示例 | 平均成本上移速度 | 回撤抵御能力 | 适用场景 |
|---------|---------|----------------|-------------|---------|
| **正金字塔 (缩量)** | 100-50-50 | 慢 | **强** | 高波动趋势市场 (如加密货币) |
| 等量金字塔 | 100-100-100 | 中 | 中 | 中等波动趋势市场 |
| 倒金字塔 (增量) | 100-200-400 | **快** | 弱 | 低波动稳定趋势市场 (极少见) |

**具体分析**：
- **倒金字塔的致命缺陷**：如果你采用 100-200-400 的结构，你的持仓均价会迅速逼近现价。市场只需一个微小的 10% 回调，你的巨额浮盈就会变成巨额亏损，触发止损时可能已经由盈转亏。
- **缩量金字塔的优势**：持仓重心始终在底部（大头在低位）。即使加满仓，均价依然显著低于现价，给你留出了厚厚的**安全垫 (Safety Buffer)**。

#### 4.3.2 执行步骤详解 (The Mechanics)

**关键参数**：
- **加仓触发距离**：价格上涨 **1.0 倍 ATR**（使用**开仓时的静态 ATR**，见下文解释）
- **最大加仓次数**：**3 次**（共 4 层仓位）—— 这是一个**可配置参数**
- **加仓比例**：100% (底仓) -> 50% -> 50% -> 50%

#### 加仓次数：参数化与最佳值建议

`MaxPyramidUnits`（最大加仓次数）应该是一个**可配置的参数**，而非硬编码常量。

**经典参考值**：

| 来源 | 建议值 | 说明 |
|------|-------|------|
| **海龟交易系统** | 4 个单位 (底仓 + 3 次加仓) | 这是趋势跟踪的经典配置，每 0.5 ATR 浮盈触发一次加仓。 |
| **Van Tharp** | 2-4 次 | 取决于市场波动率和个人风险承受能力。 |
| **学术量化研究** | 总仓位 2x-3x | 即 1-2 次加仓，保守派主流配置。 |

**针对加密货币市场的建议**：

| 风格 | 加仓次数 | 总层数 | 总杠杆 | 适用场景 |
|------|---------|-------|-------|---------|
| **保守型** | 2 次 | 3 层 | 1.5-2x | 高波动小币种（SOL, AVAX），或震荡市 |
| **标准型** | 3 次 | 4 层 | 2-3x | 主流币种（BTC, ETH），牛市行情 |
| **激进型** | 4+ 次 | 5+ 层 | 3x+ | **不建议用于加密货币**，仅适合低波动传统市场 |

**为什么加密货币不建议超过 3 次加仓？**
1. **回调幅度大**：加密货币常见 20%-30% 的日内回调，过多加仓会导致在高位重仓，随后被巨幅回调全部扫掉。
2. **跳空风险**：杠杆过高时，一个 20% 的跳空可能导致穿仓。
3. **边际效益递减**：趋势末端的加仓盈亏比极差。

| 步骤 | 触发条件 | 操作量 | 止损调整 (关键!) | 账户风险状态 |
|------|---------|-------|----------------|------------|
| **1. 底仓** | 价格突破 20 日最高点 | 1.0 Unit | 开仓价 - 2.5 ATR | **风险：1R (1% 资金)** |
| **2. 第一次加仓** | 价格较开仓价上涨 > 1 ATR | 0.5 Unit | **强制上移至：底仓开仓价 (P₀)** | **风险：~0.2R** (几乎归零) |
| **3. 第二次加仓** | 价格较加仓1价格再涨 > 1 ATR | 0.5 Unit | **上移至：第一次加仓价** | 风险：0R (锁定部分利润) |
| **4. 第三次加仓** | 价格较加仓2价格再涨 > 1 ATR | 0.5 Unit | **上移至：第二次加仓价** | 风险：0R (锁定更多利润) |

> [!IMPORTANT]
> **"移至保本"的精确含义**：这里的"保本"是指**保"首仓"的本**，而非保"全部仓位"的本。
> - **首仓 (1.0 Unit)**：在首仓开仓价 P₀ 被止损时，盈亏 = 0。**本金完全保全。**
> - **加仓 (0.5 Unit)**：它是在 P₀ + 1 ATR 买入的。如果在 P₀ 被止损，它会亏损 1 ATR 的距离，折合约 **0.2% 资金**。
> - **设计逻辑**：我们牺牲了加仓部分的完美保本，换取了更早收紧止损、锁定本金的机会。如果要做到真正的全仓保本，止损需要移至加权平均成本 `P₀ + 0.33 ATR`，但这样止损极窄，容易被震出。

**关键机制解释：止损的"风险置换" (Risk Transition)**

> 这是本策略最核心的创新点，也是用户最常问到的问题。

**问题**：第一次加仓时，为什么要把止损"强制"移到开仓价？这不是让止损变窄了吗？

**答案**：是的，这是一种**"主动失效"（Override）**，我们暂时牺牲了"跟踪止损 3ATR"的宽松空间，换取的是**本金的绝对安全**。

**数学验证**：
- 触发第一次加仓时，价格已上涨 1 ATR。
- 如果按 3 ATR 跟踪止损逻辑，此时止损应在 `(Entry + 1 ATR) - 3 ATR = Entry - 2 ATR`，这**还是亏损状态**。
- 我们**强制**将止损提至 `Entry` (开仓价)：
    - **代价**：止损变窄了（从 3 ATR 变成了 1 ATR 距离），更容易被扫地出局。
    - **收益**：**没有本金风险了**。这对于加了杠杆的账户至关重要。

**理论支撑**：这正是 **Van Tharp 的 "0R Trade"** 和 **Livermore 的 "Market's Money"** 原则的直接应用。

**"交接棒"机制**：只有当价格继续大幅上涨，使得 `最高价 - 3 ATR` **自然超过**了你的加仓锁定价时，标准的移动止损 (3 ATR) 才正式接管控制权。

#### 4.3.3 ATR 的动态 vs 静态使用

这是另一个高频问题，需要精确区分：

| 用途 | ATR 类型 | 解释 |
|------|---------|------|
| **加仓间距** | **静态 ATR (开仓时刻)** | 使用开仓时刻的 ATR 来确定加仓目标（如开仓价 + 1N, + 2N）。如果用动态 ATR，当行情剧烈上涨时，ATR 会变大，导致加仓点被推得很远；或者 ATR 变小，导致加仓过密。使用一把"固定的尺子"来衡量加仓结构更稳健。 |
| **跟踪止损** | **动态 ATR (最新值)** | 止损线 = 最高价 - 3 × **最新 ATR**。因为随着价格上涨，波动率通常会放大（币圈特有）。如果还用开仓时的小 ATR 做止损，很容易被扩大的日内震荡洗出去。 |

### 4.4 离场规则 (Exit Rules)

多头离场有两种机制，以**先触发者为准**：

#### 4.4.1 移动止损 (Trailing Stop)

**启用条件**（二者满足其一即可）：
1. **加仓阶段完成后**：当你完成了第三次加仓（共 4 层仓位），此后自动启用跟踪止损。
2. **自然超越时**：在任何阶段，如果计算出的跟踪止损位 `最高价 - 3 ATR` **自然超过**了当前的"锁定止损位"（如保本位或上一次加仓位），则跟踪止损自动接管。

**计算公式**：采用**吊灯止损 (Chandelier Exit)**：
$$
\text{止损位} = \text{历史最高价} - 3.0 \times ATR(\text{最新})
$$

**示例**：
- 开仓价 P₀ = $50,000，ATR = $2,000。
- 第一次加仓后，止损锁定在 P₀ = $50,000。
- 价格继续上涨到 $58,000（最高价）。
- 计算跟踪止损：$58,000 - 3 × $2,000 = **$52,000**。
- 此时 $52,000 > $50,000，**跟踪止损自动接管**。

**设计要点**：
- 离场宽容度 (3.0 ATR) **大于**入场止损 (2.5 ATR)，这是"让利润奔跑"的体现。
- 每根日线收盘时重新计算，止损线**只能上移，不能下移**。

#### 4.4.2 趋势反转信号

当价格跌破**过去 20 日最低价 (Donchian Low 20)** 时，无条件全部清仓。

**逻辑**：20 日低点被跌破，意味着趋势结构被破坏，不值得继续持有。

---

## 五、空头辅助系统 (The Short Module)

用户通常希望"全天候赚钱"。既然要做空，我们必须给做空**戴上镣铐**。

### 5.1 为什么做空在加密货币市场格外危险？

#### 5.1.1 数学不对称

- **做多**：最多亏 100%（归零），收益无上限（10 倍、100 倍）。
- **做空**：最多赚 100%（归零），亏损**无上限**（理论上无穷大）。

> 做空一个涨 10 倍的币，意味着亏损 1000%。

#### 5.1.2 长期正向漂移 (Positive Drift)

- 法币长期贬值（通胀）。
- 优质加密资产长期升值（BTC 自诞生以来年化复合增长率超过 100%）。
- **做空是在逆历史潮流而为**。

#### 5.1.3 扎空 (Short Squeeze)

这是币圈的"特产"：
- 当做空者过度拥挤时，主力可以**故意拉盘**爆掉空单。
- 被强平的空单变成买单，推动价格进一步上涨。
- 这种**连锁反应**可以让价格在几分钟内暴涨 20%-50%。

标志性事件：2021 年 7 月，BTC 从 $29,000 在一周内反弹至 $42,000，爆掉了数十亿美元的空单。

### 5.2 "镣铐"规则 (The Handcuffs)

基于上述风险，空头模块必须遵守以下规则，**不可逾越**：

#### 规则一：半仓试错

- 初始风险 (R) 降为 **0.5%**（做多是 1%）。
- **理由**：如果不幸赶上暴力拉盘，伤亡减半。最坏情况下，连续亏损 20 次才损失 10%，账户依然可以翻盘。

#### 规则二：严禁加仓 (No Pyramiding)

这与做多完全相反。

- **逻辑**：
    - 做多是顺势，越涨越安全（离止损越远）。
    - 做空是"火中取栗"，越跌反弹风险越大（V 型反转概率增加）。
- **推演**：如果在低位加了重仓空单，一旦发生 20% 的暴力反弹，你的所有浮盈会瞬间蒸发并倒赔。
- **战术**：**一击脱离**。空头只做"单发狙击"，做对了一直拿（跟踪止损），做错了立刻跑（硬止损），绝不恋战，绝不补仓。

#### 规则三：更宽的止损

- 初始止损放宽至 **3.0 ATR**（做多是 2.5 ATR）。
- **理由**：给予空单更多的容错率，防止被插针洗盘。熊市中的反弹通常剧烈且快速。

#### 空头入场与离场规则

| 项目 | 做多 | 做空 |
|------|------|------|
| **趋势过滤** | Price > EMA(200) | Price < EMA(200) |
| **入场信号** | 突破 20 日高点 | 跌破 20 日低点 |
| **初始风险 (R)** | 1% | **0.5%** |
| **初始止损** | 2.5 ATR | **3.0 ATR** |
| **加仓** | 允许 (缩量金字塔) | **禁止** |
| **离场** | 跌破 20 日低点 或 移动止损 | 突破 20 日高点 或 移动止损 |

---

## 六、资金管理与组合构建

### 6.1 固定单元制 (Fixed Fractional Slots)

不要每次有信号就按剩余资金比例开仓。这会导致先入场的币仓位大，后入场的仓位小，风险敞口不均匀。

**建议方法**：将资金分为 **N 份 (Slots)**，建议 N = 5。

**执行方式**：
1. 如果 BTC 出了信号，买入 1 个单元 (总资金 / 5)。
2. 如果 ETH 出了信号，买入 1 个单元。
3. ...依此类推，直到 5 个单元全部占满。
4. **资金锁定**：如果有第 6 个币（如 DOGE）出了信号，但你的 5 个单元都在持仓中，**忽略该信号**，除非你平掉手里的一个腾出位置。

**逻辑**：
1. **优胜劣汰**：最先突破的往往是该周期的真龙头，我们优先持有它们。
2. **相关性防御**：币圈资产高度相关（同涨同跌）。持有 5 个币和持有 20 个币的分散效果几乎一样，但 20 个币会让你手忙脚乱且被垃圾币拖累收益。

### 6.2 标的池选择

只交易**流动性最好的 Top 10 币种**：BTC, ETH, SOL, XRP, BNB 等。

**禁止交易**：
- 市值排名 50 名之后的小币种（流动性枯竭风险）。
- 新上线不足 3 个月的币种（历史数据不足）。
- 交易量过低的币种（滑点巨大）。

---

## 七、风险控制与极端情况处理

### 7.1 单笔最大亏损

- 做多：不超过账户权益的 **1%**。
- 做空：不超过账户权益的 **0.5%**。

### 7.2 单日最大亏损

如果单日亏损达到账户权益的 **3%**，暂停当日所有交易，次日再恢复。

### 7.3 最大总杠杆

即使加满仓（4 层），总杠杆也应控制在 **2-3 倍**以内。

**公式**：
$$
\text{总杠杆} = \frac{\sum \text{各层仓位市值}}{\text{账户权益}}
$$

**限制 3 次加仓的原因**（详见 FAQ）：
1. 防范**跳空风险 (Gap Risk)**：止损单不是保险箱，极端行情下可能无法成交。
2. **边际效益递减**：趋势末端的加仓成本太高，盈亏比急剧下降。

### 7.4 极端事件处理

| 事件 | 识别标志 | 操作 |
|------|---------|------|
| **交易所宕机** | 无法访问交易页面 | 暂停所有操作，等待恢复后检查持仓状态 |
| **黑天鹅 (Flash Crash)** | 价格 1 小时内下跌 > 20% | 不要抄底，等待市场稳定后再评估 |
| **资金费率异常** | 年化 > 100% 或 < -100% | 立即减仓或清仓，费率正常化后再入场 |

---

## 八、深度设计问答 (FAQ)

### Q1：如果我做空也用金字塔会怎样？

**后果：你极可能在熊市底部被"一波带走"。**

加密货币的熊市与股市不同，它不是缓跌，而是**急跌接暴涨 (Flash Crash then Rip)**。

**场景模拟**：
1. 你做空 BTC，价格从 $60,000 跌到 $50,000（加仓），跌到 $40,000（再加仓）。此时你重仓持有空单，均价在 $45,000 左右。
2. 市场情绪极度恐慌，突然一个利好（或仅仅是空头平仓）触发了**轧空 (Short Squeeze)**。
3. 价格在 1 小时内从 $40,000 拉升至 $50,000（涨幅 25%）。
4. **结果**：你的浮盈瞬间归零，且因为重仓加空，可能已经由盈转亏，止损单可能因流动性枯竭而滑点巨大。

**结论**：金字塔做空是在赌市场会"一直跌不回头"，但这在币圈几乎不可能发生。

### Q2：第一次加仓后风险是 0 吗？

**严格来说，不是 0，是约 0.2%。**

**数学复盘**：
- 初始设定：底仓 1 Unit，止损 2.5 ATR。风险 = 1% 总资金。
- 触发加仓：价格上涨 1 ATR。
- 此时动作：加仓 0.5 Unit，止损移至**底仓开仓价**。
- **若立即触发新止损**：
    - **底仓 (1.0 Unit)**：在开仓价离场，盈亏 = 0。
    - **加仓 (0.5 Unit)**：在开仓价 + 1 ATR 进场，在开仓价离场，亏损 1 ATR。
    - **总亏损**：0.5 Unit × 1 ATR。
- **量化风险**：由于 1 Unit × 2.5 ATR = 1% 资金，那么 0.5 Unit × 1 ATR = **0.2% 资金**。

**结论**：虽然不是纯 0，但 0.2% 的风险博取翻倍的机会，是可以接受的"运营成本"。

### Q3：为什么不能无限加仓？

**为了防止"跳空风险"和"边际效益递减"。**

1. **跳空风险 (Gap Risk)**：
    - 止损单并不是保险箱。如果发生黑天鹅（交易所宕机、战争爆发等），价格可能直接跳空 20%。
    - 如果你加了 10 次仓，杠杆倍数可能高达 5-10 倍。一个 20% 的跳空会让你的账户直接**穿仓 (负资产)**。
    - **限制 3 次加仓**是为了将总杠杆控制在安全线 (通常 < 3 倍) 以内。
2. **边际效益递减**：
    - 后期加仓的成本很高，很容易在趋势末尾"站岗"。
    - 当趋势运行了 3-4 个 ATR 后，回调的概率在增加。此时再加仓，盈亏比已经不再性感。

### Q4：为什么要用"缩量金字塔"而非倒金字塔？

**为了在大幅回撤中活着。**

- 倒金字塔（100-200-400）会迅速拉高均价，只需一个 10% 的常规回调就会让浮盈变亏损。
- 缩量加仓（100-50-50）能保持持仓重心在底部，让你扛得住牛市途中的颠簸。

### Q5：移动止损和止盈可以统一吗？

**必须统一。**

- 在趋势跟踪中，**没有"目标止盈" (Target Profit) 的概念**。我们不知道比特币会涨到 10 万还是 20 万。
- **移动止损 (Trailing Stop) 就是你的止盈单**：
    - 刚开仓时，它是止损（保护本金）。
    - 浮盈后，它跟随价格上移，变成了止盈（锁定利润）。
    - 当价格触及这条线时，无论是亏损还是盈利，逻辑是一样的：**"趋势可能反转了，我退出"**。

### Q6：加仓时把止损移到开仓价，是不是意味着跟踪止损(3ATR)失效了？

**是的，这是一种"主动失效"（Override），专业术语叫"风险置换" (Risk Transition)。**

- **逻辑冲突**：当价格上涨 1 ATR 触发第一次加仓时，按 3 ATR 逻辑，止损线应该在 `(Entry + 1) - 3 = Entry - 2 ATR`。这还是亏损状态。
- **强制归零**：我们**强制**将止损提至 `Entry` (开仓价)。
    - **代价**：止损变窄了（从宽松的 3ATR 变成了 1ATR 距离），更容易被扫地出局。
    - **收益**：**没有本金风险了**。这对于加了杠杆的账户至关重要。
- **交接棒**：只有当价格继续大幅上涨，使得 `最高价 - 3 ATR` **自然超过**了你的加仓锁定价时，标准的移动止损才正式接管比赛。

### Q7：这种"移至保本"的设计有理论依据吗？

**有的，这是经典的主动型资金管理策略。**

1. **Van Tharp 的 "0R Trade" 理论**：
    - 著名的交易心理学导师 Van Tharp 提出，交易的第一目标是迅速将风险 (Initial Risk, R) 降为 0。
    - 他认为，只有当你的底仓变成 "0R 状态"（即止损移至保本）时，你才拥有了使用杠杆加仓的"资格"。
2. **Jesse Livermore 的 "Market's Money"**：
    - 华尔街传奇利弗莫尔强调：**"必须要用市场的钱去赌"**。
    - 我们的加仓逻辑正是如此：第一次加仓后，风险归零。所有后续的风险暴露（加仓部分），实际上都是在消耗**"浮盈"（市场的钱）**，而不再威胁你的本金。

### Q8：这是否与"截断亏损，让利润奔跑"矛盾？

**在"积累期"矛盾，在"成熟期"一致。**

- **积累期 (Pyramiding Phase)**：我们优先选择**"截断亏损"**（极窄止损），甚至不惜牺牲一部分潜在利润（被震出局）。因为此时杠杆正在急剧放大，生存是第一位的。
- **成熟期 (Trending Phase)**：一旦加仓完成并在高位运行，我们通过 3 ATR 的宽止损，坚定执行**"让利润奔跑"**。

---

## 九、回测验证清单

在实盘前，请按以下步骤严格验证：

1. **数据要求**：
    - 时间范围：2017-2024（包含两轮完整牛熊周期：2017 牛市、2018 熊市、2020-2021 牛市、2022 熊市、2023-2024 回暖）。
    - K 线级别：建议使用 1 小时或 4 小时 K 线合成日线数据，避免单一数据源偏差。

2. **标的选择**：
    - BTC, ETH, SOL（高流动性）。
    - 可选扩展：XRP, BNB, AVAX。

3. **成本建模**：
    - **交易手续费**：双边 0.1% (开仓 0.05% + 平仓 0.05%)。
    - **滑点**：至少 0.1%（突破入场时滑点尤其大）。
    - **资金费率**：必须按历史费率计算，牛市中做多成本可能高达年化 20%-50%。

4. **压力测试**：
    - 重点检查 **2020.3.12 ("312")** 的表现：当日 BTC 暴跌 50%，确保多头模块能及时止损，不会爆仓。
    - 重点检查 **2021.5.19 ("519")** 的表现：确保能锁定牛市利润并及时离场。
    - 检查空头模块在 **2021 年 7 月反弹**中的表现：确保不会因为轧空而巨亏。

5. **关键指标**：
    - **年化收益率**：目标 > 50%（牛市年份应远超此值）。
    - **最大回撤**：目标 < 30%（显著优于买入持有的 70-80%）。
    - **夏普比率**：目标 > 1.0。
    - **胜率**：预期 35%-40%（这是正常的，我们靠盈亏比补偿）。

---

## 十、总结与核心公式速查

### 10.1 策略核心理念

> **"在极高波动性的市场中，保证'生存'优先，其次才是'暴富'。"**

- 缩量金字塔 = **防猝死**（控制平均成本上移速度）
- 动态 ATR 止损 = **防洗盘**（根据市场温度调整呼吸空间）
- 风险置换 = **锁本金**（用浮盈置换风险）
- 连续移动止损 = **锁利润**（让利润奔跑，同时保护成果）
- 固定单元资金管理 = **防踏空且不过度分散**

### 10.2 核心公式速查

| 公式 | 表达式 |
|------|--------|
| **初始持仓** | `(账户权益 × 1%) / (2.5 × ATR)` |
| **加仓触发** | 价格上涨 `1 × ATR(静态)` |
| **移动止损** | `最高价 - 3 × ATR(动态)` |
| **趋势反转离场** | 价格跌破 20 日最低点 |

### 10.3 趋势跟踪的本质

这个策略的设计初衷不是为了追求胜率，而是为了追求**极端的盈亏比**。

- 我们接受在震荡市中频繁地、小额地亏损 (每次 0.5% - 1%)。
- 我们通过**过滤器**尽量避开震荡。
- 我们通过**缩量金字塔**和**移动止损**，确保一旦抓住了那个属于我们的 "Big Trend" (如 2021 年的 SOL，2023 年的 BTC)，我们能**重仓**吃到最后，一波赚回 10 次的亏损。

> **趋势跟踪的本质：输得起，赢个够。**
